<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pixel‑Perfect Valentine — Butku ❤ Bandar</title>
<style>
  :root{
    --pink:#ff4d6d; --bg1:#fff0f7; --bg2:#ffe6f2; --ink:#222;
  }
  html,body{height:100%}
  body{
    margin:0; background: radial-gradient(1100px 700px at 50% 20%, var(--bg1), var(--bg2));
    color:var(--ink); font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Comic Sans MS', cursive, sans-serif;
    display:flex; flex-direction:column; align-items:center; justify-content:center; gap:14px; overflow:hidden;
  }
  header{
    position:fixed; top:8px; left:8px; right:8px; display:flex; align-items:center; justify-content:space-between; gap:10px;
  }
  .btn{
    appearance:none; border:none; border-radius:999px; padding:8px 14px; font-weight:800; cursor:pointer;
    background:#fff; color:var(--pink); border:2px solid var(--pink); text-decoration:none;
    box-shadow:0 4px 16px rgba(0,0,0,.08);
  }
  .btn:hover{ transform:translateY(-1px); box-shadow:0 8px 24px rgba(0,0,0,.12) }
  canvas{ image-rendering: pixelated; background:#fff; border:6px solid var(--pink); border-radius:22px; box-shadow:0 14px 36px rgba(255,77,109,.25) }
  footer{ position:fixed; bottom:10px; left:0; right:0; text-align:center; color:#777; font-size:12px }
</style>
</head>
<body>
  <header>
    index.html← Back</a>
    <div style="display:flex; gap:8px;">
      <button class="btn" id="toggleGrid" aria-pressed="false">Grid: Off</button>
      <button class="btn" id="toggleAnim" aria-pressed="false">Pause</button>
    </div>
  </header>

  <canvas id="screen" width="160" height="120" aria-label="Pixel animation"></canvas>

  <footer>Made with ❤️ by Siddharth</footer>

<script>
(() => {
  // ---------------- Config ----------------
  const W = 160, H = 120;                 // logical pixel grid (more detail than 128×96)
  const BG = '#ffffff';
  const INK = '#000000';
  const HEART = '#ff4d6d';

  // ---------------- Visible & pixel canvas ----------------
  const c = document.getElementById('screen');
  const sctx = c.getContext('2d');
  const px = document.createElement('canvas'); px.width = W; px.height = H;
  const ctx = px.getContext('2d', { willReadFrequently: false });

  // Fit to window with integer scale (no blur)
  function fit() {
    const scale = Math.max(1, Math.floor(Math.min(window.innerWidth / W, window.innerHeight / H) * 0.96));
    c.width = W * scale; c.height = H * scale;
    c.style.width = c.width + 'px'; c.style.height = c.height + 'px';
  }
  window.addEventListener('resize', fit, {passive:true});
  fit();

  // ---------------- Pixel helpers ----------------
  function clear(color=BG){ ctx.fillStyle=color; ctx.fillRect(0,0,W,H); }
  function plot(x,y,color=INK){ if(x>=0 && y>=0 && x<W && y<H){ ctx.fillStyle=color; ctx.fillRect(x|0,y|0,1,1); } }
  function hline(x,y,w,color=INK){ const X=(x|0); for(let i=0;i<w;i++) plot(X+i, y|0, color); }
  function vline(x,y,h,color=INK){ const Y=(y|0); for(let i=0;i<h;i++) plot(x|0, Y+i, color); }
  // Bresenham line (1px crisp)
  function line(x0,y0,x1,y1,color=INK){
    x0|=0; y0|=0; x1|=0; y1|=0;
    let dx=Math.abs(x1-x0), sx=x0<x1?1:-1;
    let dy=-Math.abs(y1-y0), sy=y0<y1?1:-1;
    let err=dx+dy, e2;
    while(true){
      plot(x0,y0,color);
      if(x0===x1 && y0===y1) break;
      e2=2*err;
      if(e2>=dy){ err+=dy; x0+=sx; }
      if(e2<=dx){ err+=dx; y0+=sy; }
    }
  }
  // Filled circle via scanlines
  function fillCircle(cx, cy, r, color=INK){
    cx|=0; cy|=0; r|=0;
    for(let y=-r; y<=r; y++){
      const dx=Math.floor(Math.sqrt(r*r - y*y));
      hline(cx - dx, cy + y, dx*2 + 1, color);
    }
  }
  // Tiny pixel heart (mask-based), size is odd number like 9 or 11
  function pHeart(cx, cy, size=9, color=HEART){
    const base = [
      " .11. .11. ",
      "1111111111",
      "1111111111",
      " 11111111 ",
      "  111111  ",
      "   1111   ",
      "    11    ",
      "     1    "
    ]; // 11 columns inc spaces; we'll scale
    const sx = size/11;
    for(let r=0;r<base.length;r++){
      for(let c2=0;c2<base[r].length;c2++){
        if(base[r][c2]==='1'){
          // scale each pixel to ~nearest int coverage
          const x = Math.round(cx - (11/2) + c2);
          const y = Math.round(cy - (base.length/2) + r);
          plot(x, y, color);
          if (sx>=1.4){ plot(x+1,y,color); plot(x,y+1,color); plot(x+1,y+1,color); }
        }
      }
    }
  }

  // ---------------- 5×7 bitmap font (caps only we need) ----------------
  // Glyphs: width 5, height 7, '#' = on. Only the letters we use.
  const FONT = {
    'A':[".###.","#...#","#...#","#####","#...#","#...#","#...#"],
    'B':["####.","#...#","#...#","####.","#...#","#...#","####."],
    'E':["#####","#....","#....","####.","#....","#....","#####"],
    'H':["#...#","#...#","#...#","#####","#...#","#...#","#...#"],
    'I':["#####","..#..","..#..","..#..","..#..","..#..","#####"],
    'L':["#....","#....","#....","#....","#....","#....","#####"],
    'M':["#...#","##.##","#.#.#","#.#.#","#...#","#...#","#...#"],
    'N':["#...#","##..#","#.#.#","#..##","#...#","#...#","#...#"],
    'O':[".###.","#...#","#...#","#...#","#...#","#...#",".###."],
    'S':[".####","#....","#....",".###.","....#","....#","####."],
    'T':["#####","..#..","..#..","..#..","..#..","..#..","..#.."],
    'U':["#...#","#...#","#...#","#...#","#...#","#...#",".###."],
    'V':["#...#","#...#","#...#","#...#",".#.#.","..#..","..#.."],
    'W':["#...#","#...#","#...#","#.#.#","#.#.#","##.##","#...#"],
    'Y':["#...#","#...#",".#.#.","..#..","..#..","..#..","..#.."],
    'N':["#...#","##..#","#.#.#","#..##","#...#","#...#","#...#"],
    ' ':[".....",".....",".....",".....",".....",".....","....."]
  };
  // Some letters appear twice in set; ensure all needed keys:
  FONT['V']=FONT['V']; FONT['A']=FONT['A']; FONT['L']=FONT['L']; FONT['E']=FONT['E']; FONT['N']=FONT['N']; FONT['T']=FONT['T']; FONT['I']=FONT['I']; FONT['O']=FONT['O']; FONT['S']=FONT['S']; FONT['U']=FONT['U']; FONT['B']=FONT['B']; FONT['W']=FONT['W']; FONT['Y']=FONT['Y']; FONT['H']=FONT['H']; FONT['M']=FONT['M'];

  function textWidth(str, scale=1, spacing=1){
    let w=0;
    for(const ch of str){ w += 5*scale + spacing; }
    return w - spacing;
  }
  function drawText(str, x, y, color=INK, align='left', scale=1, spacing=1){
    const total = textWidth(str, scale, spacing);
    let cx = x|0;
    if(align==='center') cx = (x|0) - (total>>1);
    if(align==='right')  cx = (x|0) - total;

    for(const ch of str){
      const g = FONT[ch] || FONT[' '];
      for(let row=0; row<7; row++){
        for(let col=0; col<5; col++){
          if(g[row][col]==='#'){
            for(let sy=0; sy<scale; sy++)
              for(let sx=0; sx<scale; sx++)
                plot(cx + col*scale + sx, y + row*scale + sy, color);
          }
        }
      }
      cx += 5*scale + spacing;
    }
  }

  // ---------------- Animation data ----------------
  const hearts = [];
  function spawnHeart(){ hearts.push({ x: Math.floor(Math.random()*W), y: H+6, vy: 0.4 + Math.random()*0.4, life:0 }); }
  let gridOn = false;
  const reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  // Buttons
  let running = true;
  const btnGrid = document.getElementById('toggleGrid');
  const btnAnim = document.getElementById('toggleAnim');
  btnGrid.addEventListener('click', ()=>{ gridOn=!gridOn; btnGrid.textContent = gridOn ? 'Grid: On' : 'Grid: Off'; btnGrid.setAttribute('aria-pressed', String(gridOn)); });
  btnAnim.addEventListener('click', ()=>{ running = !running; btnAnim.textContent = running ? 'Pause' : 'Play'; btnAnim.setAttribute('aria-pressed', String(!running)); if(running){ last = performance.now()/1000; requestAnimationFrame(loop); } });

  // ---------------- Figure drawing ----------------
  function drawFigure(t){
    const cx = W>>1, baseY = Math.floor(H*0.66);
    const bob = Math.round(Math.sin(t*2)*1.5);
    const sway = Math.sin(t*1.1)*2; // small sway in pixels

    // Torso
    line(cx + sway, baseY-18 + bob, cx + sway, baseY + 10 + bob, INK);

    // Arms
    line(cx + sway, baseY-12 + bob, cx - 12 + sway, baseY - 4 + bob, INK); // left akimbo
    line(cx + sway, baseY -10 + bob, cx + 14 + sway, baseY - 5 + bob, INK); // right to stick

    // Lollipop stick
    line(cx + 14 + sway, baseY - 5 + bob, cx + 14 + sway, baseY + 6 + bob, '#555');

    // Legs
    line(cx + sway, baseY + 10 + bob, cx - 9 + sway, baseY + 26 + bob, INK);
    line(cx + sway, baseY + 10 + bob, cx + 9 + sway, baseY + 26 + bob, INK);
    // Feet blocks
    hline(cx - 10 + sway, baseY + 26 + bob, 3, INK);
    hline(cx + 8 + sway,  baseY + 26 + bob, 3, INK);

    // Head (filled circle in pixels)
    const headY = baseY - 26 + bob;
    fillCircle(cx + sway, headY, 9, INK); // outline/solid head silhouette
    // Make face hole (white) then redraw thin outline for crisp look
    fillCircle(cx + sway, headY, 8, BG);
    // Eyes (blink)
    const blink = (Math.floor(t*6) % 24) === 0; // quick blink periodically
    if(blink){
      hline(cx - 3 + sway, headY-1, 3, INK);
      hline(cx + 1 + sway, headY-1, 3, INK);
    }else{
      // tiny 2×2 squares
      plot(cx - 3 + sway, headY-2, INK); plot(cx - 2 + sway, headY-2, INK);
      plot(cx - 3 + sway, headY-1, INK); plot(cx - 2 + sway, headY-1, INK);
      plot(cx + 2 + sway, headY-2, INK); plot(cx + 3 + sway, headY-2, INK);
      plot(cx + 2 + sway, headY-1, INK); plot(cx + 3 + sway, headY-1, INK);
    }
    // Hair spikes
    vline(cx - 2 + sway, headY-11, 3, INK);
    vline(cx + 0 + sway, headY-12, 4, INK);
    vline(cx + 2 + sway, headY-11, 3, INK);

    // Heart candy near mouth (pixel heart mask)
    const pulse = (Math.sin(t*4)*0.5 + 1.5); // 1.0..2.0
    pHeart(cx + 8 + sway, headY + 1, Math.round(9*pulse), HEART);
  }

  // ---------------- Main loop ----------------
  let last = performance.now()/1000, emitter=0;
  function loop(nowMs){
    const now = nowMs/1000;
    const dt = Math.min(0.033, Math.max(0, now - last)); last = now;
    const t = now;

    clear(BG);

    // Top text (5×7 font, scaled)
    drawText("WILL YOU  BE MINE", W>>1, 6, INK, 'center', 2, 1);

    // Figure
    drawFigure(t);

    // Bottom text
    drawText("ON THIS  VALENTINE", W>>1, H-20, INK, 'center', 2, 1);

    // Background hearts
    if(!reduceMotion){
      emitter += dt;
      if(emitter > 0.22){ emitter = 0; spawnHeart(); }
      for(let i=hearts.length-1;i>=0;i--){
        const h = hearts[i];
        h.y -= h.vy;
        pHeart(h.x|0, h.y|0, 7, `rgba(255,77,109,${Math.max(0, (h.y+8)/H)})`);
        if(h.y < -10) hearts.splice(i,1);
      }
    }

    // Optional grid (for verification)
    if(gridOn){
      for(let gx=0; gx<W; gx+=8) vline(gx, 0, H, '#eee');
      for(let gy=0; gy<H; gy+=8) hline(0, gy, W, '#eee');
    }

    // Blit nearest-neighbor
    sctx.clearRect(0,0,c.width,c.height);
    sctx.imageSmoothingEnabled = false;
    sctx.drawImage(px, 0, 0, c.width, c.height);

    if(running) requestAnimationFrame(loop);
  }

  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
